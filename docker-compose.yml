# This file is auto-generated by the Mailu configuration wizard.
# Please read the documentation before attempting any change.
# Generated for compose flavor

version: '3.6'
volumes:
  pritunl_data:
    driver: local
  pritunl_db:
    driver: local

services:

  pritunl:
    image: 'jippi/pritunl:latest'
    privileged: true
    ports:
      - '1194:1194/udp'
      - '1194:1194/tcp'
    volumes:
      - 'pritunl_data:/var/lib/pritunl'
      - 'pritunl_db:/var/lib/mongodb'
    labels:
      - "InsecureSkipVerify=true"
     # - "traefik.passHostHeader=true"
      - 'traefik.port=443'
      - "traefik.protocol=https"
      - 'traefik.frontend.rule=Host:vpn.${TRAEFIK_DOMAIN}'


  portainer:
    image: portainer/portainer
    command: --no-auth -H unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    labels:
      - 'traefik.backend=portainer'
      - 'traefik.port=9000'
      - "traefik.protocol=http"
      - 'traefik.frontend.rule=Host:portainer.${TRAEFIK_DOMAIN}'


  samba:
    command: "-s \"storage;/storage;yes;no;yes;admin;admin\""
    environment:
      - USERID=1000
      - GROUPID=1000
#      - "TZ=${DOCKER_TZ}"
      - "NMBD=True"
      - "RECYCLE=False"
      - "USER=admin;admin;1001;admin"
    hostname: fileserver
    image: dperson/samba
    restart: always
    volumes:
      - "./samba:/etc/samba"
      - "/mnt/storage:/storage"
#    networks:
#      frontend:
#        ipv4_address: 192.168.77.7
    labels:
      - "traefik.enable=false"


  # This would normally not be here, but where you define your system services
#  traefik:
#    image: traefik:alpine
#    command: --docker --api
#    restart: always
#    env_file: mailu.env
#    ports:
#      - "80:80"
#      - "443:443"
#    volumes:
#      - "/var/run/docker.sock:/var/run/docker.sock"
#      - "./traefik/acme.json:/acme.json"
#      - "./traefik/traefik.toml:/traefik.toml"
#      # This may be needed (plus defining mailu_default external: true) if traefik lives elsewhere
#      # networks:
#      # - mailu_default
#    labels:
#     # - "traefik.docker.network=frontend"
#      - "traefik.enable=true"
#      - "traefik.frontend.rule=Host:${TRAEFIK_DOMAIN}; PathPrefixStrip:/traefik"
#      - "traefik.port=8080"
#      - "traefik.protocol=http"

#  certdumper:
#    restart: always
#    image: mailu/traefik-certdumper:1.6
#    #env_file: mailu.env
#    environment:
#    # Make sure this is the same as the main=-domain in traefik.toml
#    # !!! Also donâ€™t forget to add "TRAEFIK_DOMAIN=[...]" to your .env!
#      - DOMAIN=mail.proshift.pp.ua
#    volumes:
#      - "./traefik:/traefik"
#      - "/mailu/certs:/output"
#    labels:
#      - "traefik.enable=false"


  # External dependencies
  redis:
    image: redis:alpine
    restart: always
    volumes:
      - "/mailu/redis:/data"
    labels:
      - "traefik.enable=false"
  # Core services
  front:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}nginx:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    logging:
      driver: json-file
    ports:
      - "185.227.108.149:80:80"
#      - "fe80::216:3eff:fe15:251:80:80"
      - "185.227.108.149:443:443"
#      - "fe80::216:3eff:fe15:251:443:443"
      - "185.227.108.149:25:25"
#      - "fe80::216:3eff:fe15:251:25:25"
      - "185.227.108.149:465:465"
#      - "fe80::216:3eff:fe15:251:465:465"
      - "185.227.108.149:587:587"
#      - "fe80::216:3eff:fe15:251:587:587"
      - "185.227.108.149:110:110"
#      - "fe80::216:3eff:fe15:251:110:110"
      - "185.227.108.149:995:995"
#      - "fe80::216:3eff:fe15:251:995:995"
      - "185.227.108.149:143:143"
#      - "fe80::216:3eff:fe15:251:143:143"
      - "185.227.108.149:993:993"
#      - "fe80::216:3eff:fe15:251:993:993"
    labels: # Traefik labels for simple reverse-proxying
      - "traefik.enable=true"
      - "traefik.port=80"
      - "traefik.frontend.rule=Host:mail.${TRAEFIK_DOMAIN}"

    volumes:
      - "/mailu/certs:/certs"
      - "/mailu/overrides/nginx:/overrides"


  admin:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}admin:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/data:/data"
      - "/mailu/dkim:/dkim"
    depends_on:
      - redis
    labels:
      - "traefik.enable=false"

  imap:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}dovecot:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/mail:/mail"
      - "/mailu/overrides:/overrides"
    depends_on:
      - front
    labels:
      - "traefik.enable=false"

  smtp:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}postfix:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/overrides:/overrides"
    depends_on:
      - front
    labels:
      - "traefik.enable=false"

  antispam:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}rspamd:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/filter:/var/lib/rspamd"
      - "/mailu/dkim:/dkim"
      - "/mailu/overrides/rspamd:/etc/rspamd/override.d"
    depends_on:
      - front
    labels:
      - "traefik.enable=false"

  webdav:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}radicale:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/dav:/data"
    labels:
      - "traefik.enable=false"

  fetchmail:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}fetchmail:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    labels:
      - "traefik.enable=false"

  webmail:
    image: ${DOCKER_ORG:-mailu}/${DOCKER_PREFIX:-}rainloop:${MAILU_VERSION:-1.6}
    restart: always
    env_file: mailu.env
    volumes:
      - "/mailu/webmail:/data"
    depends_on:
      - imap
    labels:
      - "traefik.enable=false"

networks:
  default:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 192.168.200.0/24